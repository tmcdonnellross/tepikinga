<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jacob ‚Äì Results</title>
  <style>
:root{
  --bg:#fff7da;
  --card:#ffffff;
  --ink:#0f172a;
  --muted:#5b6478;
  --accent:#f59e0b;
  --accent-weak:#fef3c7;
  --shadow:0 10px 25px rgba(2,6,23,.06);
  --radius:16px;
  --table-row:#fcfdff;
  --table-grid:#eef2ff;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0}
body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
  color:var(--ink);background:linear-gradient(180deg,var(--bg),#f7fbff 60%);}
.container{max-width:1100px;margin:32px auto;padding:0 20px}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;}
.brand{display:flex;align-items:center;gap:12px;font-weight:800;font-size:20px}
.brand .logo{width:36px;height:36px;border-radius:10px;background:var(--accent);
  box-shadow:inset 0 -10px 20px rgba(255,255,255,.25);display:grid;place-items:center;color:white;font-weight:900;}
.subtle{color:var(--muted)}
.grid{display:grid;gap:16px;grid-template-columns: repeat(auto-fit,minmax(240px,1fr));}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;border:1px solid var(--table-grid);transition:transform .08s ease;}
.card:hover{transform:translateY(-2px)}
.card h3{margin:4px 0 4px;font-size:18px}
.card p{margin:0;color:var(--muted);font-size:14px}
.kicker{font-weight:800;letter-spacing:.02em;text-transform:uppercase;color:#334155;margin:6px 0 10px;font-size:14px}
.table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:10px}
.table th,.table td{padding:10px 12px;background:var(--table-row);border:1px solid var(--table-grid)}
.table th{color:#334155;font-size:12px;letter-spacing:.02em;text-transform:uppercase;background:var(--accent-weak)}
.charts{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));}
canvas{width:100%;height:240px}
.backlink{display:inline-flex;align-items:center;gap:8px;color:var(--accent);text-decoration:none;font-weight:700}
.login{max-width:560px;margin:12px 0 20px;display:none}
.btn{display:inline-flex;align-items:center;gap:8px;background:var(--accent);color:#fff;border:none;border-radius:10px;
  padding:10px 14px;font-weight:700;cursor:pointer;box-shadow:var(--shadow);}
.input{padding:10px 12px;border-radius:10px;border:1px solid var(--table-grid);width:220px;margin-right:8px}
.summary{background:var(--accent-weak);border:1px solid var(--table-grid);padding:14px;border-radius:12px}
</style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="index.html" class="backlink">‚Üê Back to class</a>
      <div class="brand"><div class="logo">üìà</div>Jacob's Progress</div>
    </div>

    <div id="login" class="card login" style="display:block;">
      <h3 style="margin-top:0;">Enter your password</h3>
      <input type="password" id="pw" class="input" placeholder="Password">
      <button class="btn" onclick="checkPassword()">Unlock</button>
      <div id="err" class="subtle" style="color:#b91c1c;margin-top:8px;"></div>
    </div>

    <div id="content" style="display:none;">
      <div class="card">
        <h2 style="margin:0;">Overview</h2>
        <p class="subtle" style="margin-top:6px;">Live from Google Sheets tab: <strong>Jacob</strong></p>
        <div id="summaryCard" class="summary" style="margin-top:12px; display:none;">
          <strong>AI Summary:</strong>
          <div id="summaryText" style="margin-top:6px;"></div>
        </div>
      </div>

      <div class="kicker">All Results (table)</div>
      <div class="card">
        <table class="table">
          <thead><tr id="headers"></tr></thead>
          <tbody id="rows"></tbody>
        </table>
      </div>

      <div class="kicker">Progress Charts</div>
      <div id="charts" class="charts"></div>
    </div>
  </div>

<script>
  const GVIZ_BASE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTCUTXjOdP3XSxBsd0JLbK1PMEodb4Kjd4bOY-MV5F7IF8nFm3N8_ciaS8vcuRVLlw5_PBQwpxChb3Q/gviz/tq?tqx=out:csv";
  const TAB = "Jacob";
  const SHEET_URL = GVIZ_BASE + "&sheet=" + encodeURIComponent(TAB);

  const stripQ = s => (s||"").replace(/^\"|\"$/g,"").replace(/^"|"$/g,"").trim();
  function parseCSV(text){ return text.trim().split(/\r?\n/).map(r => r.split(",")); }

  function hexToRgba(hex, alpha) {
    const h = hex.replace('#','');
    const r = parseInt(h.substring(0,2),16);
    const g = parseInt(h.substring(2,4),16);
    const b = parseInt(h.substring(4,6),16);
    return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + alpha + ')';
  }
  function getAccent() {
    const s = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
    return s || '#2563eb';
  }

  async function checkPassword() {
    const input = document.getElementById('pw').value.trim();
    try {
      const res = await fetch('passwords.json?cache=' + Date.now());
      const map = await res.json();
      const expected = (map[TAB] || '').trim();
      if (expected && input === expected) {
        document.getElementById('login').style.display = 'none';
        document.getElementById('content').style.display = 'block';
        loadData();
      } else {
        document.getElementById('err').textContent = 'Incorrect password';
      }
    } catch (e) {
      document.getElementById('err').textContent = 'Password file missing (passwords.json)';
    }
  }

  function pickLatestNonEmpty(arr) {
    for (let i = arr.length - 1; i >= 1; i--) {
      const v = stripQ(arr[i]);
      if (v) return v;
    }
    return '';
  }

  async function loadData() {
    const url = SHEET_URL + '&t=' + Date.now();
    const res = await fetch(url);
    const text = await res.text();
    const rows = parseCSV(text);
    if(!rows.length) return;
    const headers = rows[0].map(stripQ);
    const headerRow = document.getElementById('headers');
    headers.forEach(function(h){ var th=document.createElement('th'); th.textContent=h||'Metric / Date'; headerRow.appendChild(th); });

    const tbody = document.getElementById('rows');
    let summaryText = '';
    rows.slice(1).forEach(function(row){
      if(row.every(function(c){ return stripQ(c)===''; })) return;
      const first = stripQ(row[0]);
      if (first.toLowerCase() === 'summary' || first.toLowerCase() === 'ai summary') {
        summaryText = pickLatestNonEmpty(row);
        return; // don't show the summary as a data row
      }
      const tr=document.createElement('tr');
      row.forEach(function(cell){ var td=document.createElement('td'); td.textContent=stripQ(cell); tr.appendChild(td); });
      tbody.appendChild(tr);
    });

    if (summaryText) {
      document.getElementById('summaryText').textContent = summaryText;
      document.getElementById('summaryCard').style.display = 'block';
    }

    const dates = headers.slice(1);
    const chartsDiv = document.getElementById('charts');
    const accent = getAccent();
    const fill = hexToRgba(accent, 0.18);

    rows.slice(1).forEach(function(row){
      const metric = stripQ(row[0]); if(!metric || metric.toLowerCase().indexOf('summary')!==-1) return;
      const values = row.slice(1).map(function(v){ var n=parseFloat(stripQ(v)); return isNaN(n)? null : n; });

      const card=document.createElement('div'); card.className='card';
      const h=document.createElement('h3'); h.textContent=metric; card.appendChild(h);
      const canvas=document.createElement('canvas'); card.appendChild(canvas);
      chartsDiv.appendChild(card);

      new Chart(canvas.getContext('2d'), {
        type:'line',
        data:{ labels:dates, datasets:[{ label:metric, data:values, borderColor: accent, backgroundColor: fill, fill:true, tension:.35 }] },
        options:{
          responsive:true,
          plugins:{legend:{display:false}},
          scales:{
            x:{ grid:{ color: hexToRgba(accent, 0.09) } },
            y:{ beginAtZero:true, grid:{ color: hexToRgba(accent, 0.09) } }
          }
        }
      });
    });
  }
</script>
</body>
</html>
